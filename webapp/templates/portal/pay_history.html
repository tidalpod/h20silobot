{% extends "portal/base.html" %}

{% block title %}Payment History{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex items-center gap-2 mb-1">
        <a href="/portal/pay" class="text-blue-600 text-sm">&larr; Back</a>
    </div>
    <h1 class="text-2xl font-bold text-gray-900">Payment History</h1>
</div>

{% if payments %}
<div class="space-y-3">
    {% for payment in payments %}
    <div class="portal-card p-4">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-sm font-semibold text-gray-900">${{ "{:,.2f}".format(payment.total_amount) }}</p>
                <p class="text-xs text-gray-500">{{ payment.payment_month.strftime('%B %Y') }}</p>
                {% if payment.is_autopay %}
                <span class="inline-flex items-center mt-1 rounded-full bg-purple-100 px-2 py-0.5 text-[10px] font-medium text-purple-700">Autopay</span>
                {% endif %}
            </div>
            <div class="text-right">
                {% if payment.status.value == 'completed' %}
                <span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">Completed</span>
                {% elif payment.status.value == 'processing' %}
                <span class="inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800">Processing</span>
                {% elif payment.status.value == 'pending' %}
                <span class="inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800">Pending</span>
                {% elif payment.status.value == 'failed' %}
                <span class="inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800">Failed</span>
                {% elif payment.status.value == 'returned' %}
                <span class="inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800">Returned</span>
                {% elif payment.status.value == 'cancelled' %}
                <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-600">Cancelled</span>
                {% endif %}
                <p class="text-xs text-gray-400 mt-1">{{ payment.initiated_at.strftime('%b %d, %Y') }}</p>
            </div>
        </div>
        {% if payment.late_fee and payment.late_fee > 0 %}
        <div class="mt-2 pt-2 border-t border-gray-100 text-xs text-gray-500">
            Rent: ${{ "{:,.2f}".format(payment.amount) }} + Late Fee: ${{ "{:,.2f}".format(payment.late_fee) }}
        </div>
        {% endif %}
        {% if payment.failure_reason %}
        <div class="mt-2 pt-2 border-t border-gray-100 text-xs text-red-500">
            {{ payment.failure_reason }}
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<div class="portal-card p-8 text-center">
    <span class="text-3xl block mb-2">&#128196;</span>
    <p class="text-sm font-medium text-gray-900">No payments yet</p>
    <p class="text-xs text-gray-500 mt-1">Your payment history will appear here</p>
</div>
{% endif %}
{% endblock %}
