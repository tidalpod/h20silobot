{% extends "vendor/base.html" %}

{% block title %}Invoice #{{ invoice.id }}{% endblock %}

{% block content %}
<a href="/vendor/invoices" class="inline-flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 mb-4">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
    Back to Invoices
</a>

<!-- Status Banner -->
<div class="portal-card p-4 mb-4
    {% if invoice.status.value == 'submitted' %}border-l-4 border-l-amber-400
    {% elif invoice.status.value == 'approved' %}border-l-4 border-l-blue-400
    {% elif invoice.status.value == 'paid' %}border-l-4 border-l-green-400
    {% elif invoice.status.value == 'rejected' %}border-l-4 border-l-red-400
    {% endif %}">
    <div class="flex items-center justify-between">
        <div>
            <span class="text-xs text-gray-400">Status</span>
            <div class="flex items-center gap-2 mt-0.5">
                <span class="text-sm font-semibold
                    {% if invoice.status.value == 'submitted' %}text-amber-700
                    {% elif invoice.status.value == 'approved' %}text-blue-700
                    {% elif invoice.status.value == 'paid' %}text-green-700
                    {% elif invoice.status.value == 'rejected' %}text-red-700
                    {% endif %}">{{ invoice.status.value|capitalize }}</span>
            </div>
        </div>
        <div class="text-right">
            <span class="text-xs text-gray-400">Amount</span>
            <div class="text-xl font-bold text-gray-900">${{ "%.2f"|format(invoice.amount) }}</div>
        </div>
    </div>
</div>

<!-- Details -->
<div class="portal-card p-4 mb-4">
    <h1 class="text-lg font-bold text-gray-900 mb-1">{{ invoice.title }}</h1>
    <p class="text-xs text-gray-400 mb-3">Invoice #{{ invoice.id }}</p>

    {% if invoice.description %}
    <p class="text-sm text-gray-700 mb-3">{{ invoice.description }}</p>
    {% endif %}

    <div class="space-y-2 text-sm">
        <div class="flex justify-between">
            <span class="text-gray-500">Property</span>
            <span class="text-gray-900">{{ invoice.property_ref.address if invoice.property_ref else 'N/A' }}</span>
        </div>
        {% if invoice.work_order_ref %}
        <div class="flex justify-between">
            <span class="text-gray-500">Work Order</span>
            <a href="/vendor/work-orders/{{ invoice.work_order_ref.id }}" class="text-purple-700 hover:text-green-700">WO #{{ invoice.work_order_ref.id }} - {{ invoice.work_order_ref.title }}</a>
        </div>
        {% endif %}
        <div class="flex justify-between">
            <span class="text-gray-500">Submitted</span>
            <span class="text-gray-900">{{ invoice.submitted_at.strftime('%b %d, %Y at %I:%M %p') if invoice.submitted_at else 'N/A' }}</span>
        </div>
        {% if invoice.approved_at %}
        <div class="flex justify-between">
            <span class="text-gray-500">Approved</span>
            <span class="text-gray-900">{{ invoice.approved_at.strftime('%b %d, %Y at %I:%M %p') }}</span>
        </div>
        {% endif %}
        {% if invoice.paid_at %}
        <div class="flex justify-between">
            <span class="text-gray-500">Paid</span>
            <span class="text-gray-900">{{ invoice.paid_at.strftime('%b %d, %Y at %I:%M %p') }}</span>
        </div>
        {% endif %}
        {% if invoice.rejected_at %}
        <div class="flex justify-between">
            <span class="text-gray-500">Rejected</span>
            <span class="text-gray-900">{{ invoice.rejected_at.strftime('%b %d, %Y at %I:%M %p') }}</span>
        </div>
        {% endif %}
    </div>
</div>

<!-- PM Notes -->
{% if invoice.notes %}
<div class="portal-card p-4 mb-4 border-l-4 border-l-gray-300">
    <h2 class="text-sm font-semibold text-gray-700 mb-1">Notes from Property Manager</h2>
    <p class="text-sm text-gray-600">{{ invoice.notes }}</p>
</div>
{% endif %}

<!-- File Preview -->
{% if invoice.file_url %}
<div class="portal-card p-4">
    <h2 class="text-sm font-semibold text-gray-700 mb-3">Attached File</h2>
    {% if invoice.file_url.endswith('.pdf') %}
    <a href="{{ invoice.file_url }}" target="_blank" class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
        <div class="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
            </svg>
        </div>
        <div class="flex-1">
            <div class="text-sm font-medium text-gray-900">View PDF</div>
            <div class="text-xs text-gray-500">Tap to open</div>
        </div>
        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
        </svg>
    </a>
    {% else %}
    <img src="{{ invoice.file_url }}" class="rounded-lg max-w-full" alt="Invoice attachment"
         onclick="window.open('{{ invoice.file_url }}', '_blank')">
    {% endif %}
</div>
{% endif %}
{% endblock %}
