{% extends "base.html" %}

{% block title %}Lease Builder - Step 5{% endblock %}

{% block header %}
<header class="bg-white shadow-sm">
    <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
        <div class="flex items-center gap-2 mb-2">
            <a href="/leases/builder" class="text-sm text-blue-600 hover:text-blue-500">&larr; All Drafts</a>
        </div>
        <h1 class="text-2xl font-bold tracking-tight text-gray-900">Utilities, Maintenance, & Keys</h1>
        <p class="mt-1 text-sm text-gray-500">{{ property.address if property else '' }}</p>
    </div>
</header>
{% endblock %}

{% block content %}
<!-- Step Indicator -->
<div class="mb-8 flex items-center gap-2">
    {% for i in range(1, total_steps + 1) %}
    <div class="flex items-center">
        <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium {% if i == step %}bg-blue-600 text-white{% elif i < step %}bg-green-500 text-white{% else %}bg-gray-200 text-gray-500{% endif %}">
            {% if i < step %}&#10003;{% else %}{{ i }}{% endif %}
        </div>
        {% if i < total_steps %}<div class="w-8 h-0.5 {% if i < step %}bg-green-500{% else %}bg-gray-200{% endif %}"></div>{% endif %}
    </div>
    {% endfor %}
</div>

<form method="POST" action="/leases/builder/{{ builder.id }}/step/5">
    <div class="max-w-2xl space-y-6">
        <!-- Utilities -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-4">
            <h2 class="text-lg font-semibold text-gray-900">Utility Responsibilities</h2>
            <p class="text-xs text-gray-500">Select who is responsible for each utility</p>
            {% set utils = data.get('utilities', {}) %}
            {% set utility_list = [
                ('electricity', 'Electricity'),
                ('gas', 'Gas'),
                ('water', 'Water'),
                ('sewer', 'Sewer'),
                ('trash', 'Trash'),
                ('internet', 'Internet'),
                ('cable', 'Cable/TV'),
            ] %}
            <div class="space-y-2">
                {% for key, label in utility_list %}
                <div class="flex items-center justify-between p-3 rounded-lg border border-gray-200">
                    <span class="text-sm font-medium text-gray-900">{{ label }}</span>
                    <div class="flex gap-3">
                        <label class="flex items-center gap-1.5 cursor-pointer">
                            <input type="radio" name="utility_{{ key }}" value="tenant" {% if utils.get(key, 'tenant') == 'tenant' %}checked{% endif %} class="text-blue-600">
                            <span class="text-sm text-gray-600">Tenant</span>
                        </label>
                        <label class="flex items-center gap-1.5 cursor-pointer">
                            <input type="radio" name="utility_{{ key }}" value="landlord" {% if utils.get(key) == 'landlord' %}checked{% endif %} class="text-blue-600">
                            <span class="text-sm text-gray-600">Landlord</span>
                        </label>
                        <label class="flex items-center gap-1.5 cursor-pointer">
                            <input type="radio" name="utility_{{ key }}" value="shared" {% if utils.get(key) == 'shared' %}checked{% endif %} class="text-blue-600">
                            <span class="text-sm text-gray-600">Shared</span>
                        </label>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Maintenance Communication -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-4">
            <h2 class="text-lg font-semibold text-gray-900">Maintenance Communication</h2>
            <p class="text-xs text-gray-500">How should tenants submit maintenance requests?</p>
            {% set maint = data.get('maintenance_communication', ['bluedeer_portal', 'email', 'text']) %}
            <div class="space-y-2">
                <label class="flex items-center gap-3 p-3 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-50">
                    <input type="checkbox" name="maintenance_communication" value="bluedeer_portal" {% if 'bluedeer_portal' in maint %}checked{% endif %} class="text-blue-600 rounded">
                    <span class="text-sm">Blue Deer Tenant Portal</span>
                </label>
                <label class="flex items-center gap-3 p-3 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-50">
                    <input type="checkbox" name="maintenance_communication" value="email" {% if 'email' in maint %}checked{% endif %} class="text-blue-600 rounded">
                    <span class="text-sm">Email</span>
                </label>
                <label class="flex items-center gap-3 p-3 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-50">
                    <input type="checkbox" name="maintenance_communication" value="text" {% if 'text' in maint %}checked{% endif %} class="text-blue-600 rounded">
                    <span class="text-sm">Text Message</span>
                </label>
                <label class="flex items-center gap-3 p-3 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-50">
                    <input type="checkbox" name="maintenance_communication" value="phone" {% if 'phone' in maint %}checked{% endif %} class="text-blue-600 rounded">
                    <span class="text-sm">Phone Call</span>
                </label>
            </div>
        </div>

        <!-- Keys -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-4">
            <h2 class="text-lg font-semibold text-gray-900">Keys & Access</h2>
            <div id="keys-container">
                {% for k in data.get('keys', [{'type': 'Front Door', 'count': 2}]) %}
                <div class="flex gap-3 mb-2 key-row">
                    <input type="text" name="key_type" value="{{ k.type }}" placeholder="Key type (e.g., Front Door)" class="flex-1 rounded-lg border border-gray-300 px-3 py-2 text-sm">
                    <input type="number" name="key_count" value="{{ k.count }}" min="1" class="w-20 rounded-lg border border-gray-300 px-3 py-2 text-sm">
                    <button type="button" onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-600 px-2">&times;</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" onclick="addKey()" class="text-sm text-blue-600 hover:text-blue-500 font-medium">+ Add Key</button>
        </div>
    </div>

    <!-- Navigation -->
    <div class="mt-6 flex justify-between max-w-2xl">
        <a href="/leases/builder/{{ builder.id }}/step/4" class="px-6 py-3 rounded-lg text-sm font-medium text-gray-700 bg-white ring-1 ring-gray-300 hover:bg-gray-50">&larr; Back</a>
        <div class="flex gap-3">
            <button type="submit" name="action" value="save" class="px-6 py-3 rounded-lg text-sm font-medium text-gray-700 bg-white ring-1 ring-gray-300 hover:bg-gray-50">Save</button>
            <button type="submit" name="action" value="continue" class="px-6 py-3 rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-500 shadow-sm">Save & Continue &rarr;</button>
        </div>
    </div>
</form>

<script>
function addKey() {
    const c = document.getElementById('keys-container');
    c.insertAdjacentHTML('beforeend', `
        <div class="flex gap-3 mb-2 key-row">
            <input type="text" name="key_type" placeholder="Key type" class="flex-1 rounded-lg border border-gray-300 px-3 py-2 text-sm">
            <input type="number" name="key_count" value="1" min="1" class="w-20 rounded-lg border border-gray-300 px-3 py-2 text-sm">
            <button type="button" onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-600 px-2">&times;</button>
        </div>
    `);
}
</script>
{% endblock %}
